<div class="bg-base-200">
  <div mat-dialog-content>
    @if (item.company) {
    <span class="label text-sm font-bold"><fa-icon class="text-info" icon="check-circle"></fa-icon> {{ item.company
      }}</span>
    }

    <h1 class="flex items-center gap-2 text-4xl font-bold">
      {{ item.name }}
    </h1>
    <item-price-tag [value]="item" [likes]="false" [showSale]="true" saleSize="sm"></item-price-tag>

    @if (item.author) {
    <div class="flex flex-row-reverse items-center text-right gap-2">
      <img class="size-12 rounded-box" src="https://img.daisyui.com/images/profile/demo/1@94.webp" />
      <div class="grid">
        <label class="text-xs uppercase opacity-60">Created by:</label>
        <a class="link" style="text-decoration: none;">{{ item.author }}</a>
      </div>
    </div>
    }

    <div class="pt-4">
      @if (item.about) {
      <text-read-more [text]="item.about" [maxLength]="150"></text-read-more>
      <br />
      }

      <a class="link" [routerLink]="['/item', {category: item.parent, item: item.name}]" (click)="cancel()">
        <fa-icon icon="arrow-up-right-from-square"></fa-icon> View Full Item Description
      </a>

      <div class="flex flex-col gap-4 items-center pt-4">
        <div class="rounded-box flex bg-base-300 justify-center w-full">
          <img class="h-56" [src]="displayImage" />
        </div>
        <div class="flex flex-wrap justify-center gap-2">
          @for (img of item.image; track img) {
          <img [class]="'link rounded-box h-12 w-12 ' + (displayImage == img ? 'ring ring-2' : '')" [src]="img"
            (click)="selectImage(img)" />
          }
        </div>
      </div>
      <br />

      <div class="flex justify-center">
        <item-details [item]="item"></item-details>
      </div>
      <br />

      @if (item.choices) {
      <div class="flex flex-col gap-2">
        @for (entry of item.choices | keyvalue; track entry.key) {
        <item-choice-list class="rounded-box bg-base-300 w-full p-4" [type]="entry.key" [choices]="entry.value"></item-choice-list>
        }
      </div>
      }
    </div>

    <div class="flex justify-between items-center">
      <h1 class="text-xl p-4">Order:</h1>
      <div class="flex flex-col items-end p-4">
        <select [class]="'select select-lg w-fit ' + ((this.item.amount > 1) ? 'outline outline-3 font-bold' : '')"
          [(ngModel)]="item.amount">
          @if (item.maxAmount) {
          @for (num of list(item.maxAmount); track num) {
          <option [value]="num">{{ num }}</option>
          }
          } @else {
          @for (num of list(defaultMaxAmount); track num) {
          <option [value]="num">{{ num }}</option>
          }
          }
        </select>

        @if (item.stockAmount != undefined) {
        @if (item.stockAmount == 0) {
        <span class="badge-xs badge-error badge text-white">out of stock</span>
        } @else if (item.stockAmount < 5) { <span class="text-xs text-error">only {{ item.stockAmount }} left</span>
          }
          }
          @if (item.price.buyOneGetOne) {
          <p>Buy 1, Get 1</p>
          }
      </div>
    </div>
  </div>

  <div mat-dialog-actions>
    <div class="grid gap-2 w-full">
      <div class="flex gap-2">
        <button
          [class]="'flex-1 btn btn-warning font-bold ' + ((item.stockAmount != undefined && item.stockAmount == 0) ? 'btn-disabled' : '')"
          (click)="saveToCart()">
          <div class="flex items-center gap-2">
            @if (item.stockAmount != undefined && item.stockAmount == 0) {
            <p>Out of stock</p>
            }
            @else {
            <p>Update Cart</p>

            @if (!item.price.buyOneGetOne && item.price.previousPrice) {
            <p class="text-sm line-through">${{ getPrice(item, item.price.previousPrice) | number: '1.2-2' }}
            </p>
            }

            <p>${{ getPrice(item, item.price.value) | number: '1.2-2' }}</p>

            @if (item.price.buyOneGetOne) {
            <p>({{ item.amount * 2 }})</p>
            } @else if (item.amount > 1) {
            <p>({{ item.amount }})</p>
            }
            }
          </div>
        </button>

        @if (item.choices && item.choices.size > 0) {
        <button class="btn tooltip tooltip-left text-xl" data-tip="Duplicate Order" (click)="duplicate()">
          <fa-icon icon="copy"></fa-icon>
        </button>
        }
      </div>

      <button class="btn bg-base-100" (click)="removeFromCart()">
        <p class="text-error">Remove Item</p>
      </button>

      <button class="btn bg-base-100" (click)="cancel()">
        Cancel
      </button>
    </div>
  </div>
</div>