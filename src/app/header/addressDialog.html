<div class="bg-base-200">
  <div mat-dialog-title>
    @if (isValidAddress) {
    <h1 class="text-4xl font-bold">Edit Address</h1>
    }
    @else {
    <h1 class="text-4xl font-bold">Add an Address</h1>
    }
  </div>

  <div mat-dialog-content class="px-1">
    <div class="skeleton w-full h-25"></div>
    <br />

    <h1>Lookup Address:</h1>
    <div class="form-control">
      <div [class]="'w-full ' + ((showAddressInfo || isValidAddress) ? 'dropdown dropdown-bottom' : 'menu')">
        <div class="flex justify-between gap-2 items-center">
          <input type="search"
            [class]="'input input-bordered placeholder-gray-350 w-full ' + (lookupAddress ? 'border border-neutral' : '')"
            placeholder="Search an address" [(ngModel)]="lookupAddress" />
          <div class="tooltip tooltip-left" data-tip="Use Current location">
            <button class="btn btn-neutral" (click)="useCurrentLocation()">
              <fa-icon icon="location-dot"></fa-icon>
            </button>
          </div>
        </div>
        @if (getError(errorTypes.LookupAddress)) {
        <div class="flex gap-1 p-1">
          <fa-icon class="text-error text-sm" icon="exclamation-circle"></fa-icon>
          <p class="font-mono text-sm text-error pb-2">{{ getError(errorTypes.LookupAddress)?.message }}</p>
        </div>
        }

        <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow-2xl bg-base-100 rounded-box w-full mt-1">
          <li>
            <div class="flex flex-col items-start gap-0 rounded-box p-2">
              <b>Label</b>
              <p>123 Manitoba ave., Winnipeg</p>
              <p class="text-sm">Manitoba R1T 2G3</p>
            </div>
          </li>
          <li>
            <div class="flex flex-col items-start gap-0 rounded-box p-2">
              <b>Label</b>
              <p>123 Manitoba ave., Winnipeg</p>
              <p class="text-sm">Manitoba R1T 2G3</p>
            </div>
          </li>
        </ul>
      </div>
    </div>
    <br />

    @if (showAddressInfo || isValidAddress) {
    <fieldset class="fieldset w-full">
      <p class="fieldset-legend text-lg">Address line:</p>

      <input type="search" placeholder="Enter Address"
        [class]="'input input-bordered placeholder-gray-350 w-full ' + (address.addressLine ? 'outline' : '') + ' ' + (getError(errorTypes.AddressLine) ? 'outline outline-error' : '')"
        [(ngModel)]="address.addressLine" (change)="clearError(errorTypes.AddressLine)" />

      @let AddressError = getError(errorTypes.AddressLine);
      @if (AddressError) {
      <p class="font-mono text-sm text-error pb-2">{{ AddressError.message }}</p>
      }
    </fieldset>

    <fieldset class="fieldset w-full">
      <p class="fieldset-legend text-lg">City:</p>

      <input type="search" placeholder="Enter City"
        [class]="'input input-bordered placeholder-gray-350 w-full ' + (address.city ? 'outline' : '') + ' ' + (getError(errorTypes.City) ? 'outline outline-error' : '')"
        [(ngModel)]="address.city" (change)="clearError(errorTypes.City)" />

      @let CityError = getError(errorTypes.City);
      @if (CityError) {
      <p class="font-mono text-sm text-error pb-2">{{ CityError.message }}</p>
      }
    </fieldset>

    <div class="flex gap-2">
      <fieldset class="fieldset w-full">
        <p class="fieldset-legend text-lg">Province:</p>

        <select class="select w-full outline" [(ngModel)]="address.province">
          @for (entry of provinceList; track entry) {
          <option [ngValue]="entry">{{ entry }}</option>
          }
        </select>
      </fieldset>

      <fieldset class="fieldset">
        <p class="fieldset-legend text-lg">Postal Code:</p>

        <input type="search" placeholder="Enter Postal Code"
          [class]="'input input-bordered placeholder-gray-350 w-full ' + (address.postal ? 'outline' : '') + ' ' + (getError(errorTypes.PostalCode) ? 'outline outline-error' : '')"
          [(ngModel)]="address.postal" (change)="clearError(errorTypes.PostalCode)" />

        @let PostalCodeError = getError(errorTypes.PostalCode);
        @if (PostalCodeError) {
        <p class="font-mono text-sm text-error pb-2">{{ PostalCodeError.message }}</p>
        }
      </fieldset>
    </div>

    <fieldset class="fieldset w-full">
      <p class="fieldset-legend text-lg justify-start">Apt / Suite / Floor:</p>

      <input type="search" placeholder="Enter Brief Instrunction"
        [class]="'input input-bordered placeholder-gray-350 w-full ' + (address.apt ? 'outline' : '') + ' ' + (getError(errorTypes.Apt) ? 'outline outline-error' : '')"
        [(ngModel)]="address.apt" (change)="clearError(errorTypes.Apt)" />

      @let AptError = getError(errorTypes.Apt);
      @if (AptError) {
      <p class="font-mono text-sm text-error pb-2">{{ AptError.message }}</p>
      }
      <p class="label justify-end w-full">Optional</p>
    </fieldset>

    <fieldset class="fieldset">
      <legend class="fieldset-legend text-lg">Building Type:</legend>

      <select class="select w-full outline" [(ngModel)]="address.buildingType">
        @for (entry of buildingTypes; track entry) {
        <option [value]="entry">{{ entry }}</option>
        }
      </select>
    </fieldset>

    <fieldset class="fieldset w-full">
      <legend class="fieldset-legend text-lg">Label:</legend>

      <div class="flex gap-2 w-full">
        <input type="search" placeholder="e.g. Home"
          [class]="'input rounded-box input-bordered placeholder-gray-350 w-full ' + (address.label ? 'outline' : '') + ' ' + (getError(errorTypes.Label) ? 'outline outline-error' : '')"
          [(ngModel)]="address.label" (change)="clearError(errorTypes.Label)" />

        <button [class]="'btn text-lg tooltip ' + (address.isFavourite ? 'border-neutral' : '')"
          [attr.data-tip]="address.isFavourite ? 'Favourite' : 'Not Favourite'"
          (click)="address.isFavourite=!address.isFavourite">
          @if (address.isFavourite) {
          <fa-icon [icon]="['fas', 'star']"></fa-icon>
          } @else {
          <fa-icon [icon]="['far', 'star']"></fa-icon>
          }
        </button>
      </div>

      @if (getError(errorTypes.Label)) {
      <p class="justify-end w-full font-mono text-sm text-error">{{ getError(errorTypes.Label)?.message }}</p>
      } @else if (address.isFavourite) {
      <p class="label justify-end w-full">Marked as Favourite</p>
      }
    </fieldset>
    }
  </div>

  <div mat-dialog-actions>
    <div class="flex justify-between w-full">
      <div class="flex gap-2">
        @if (isValidAddress) {
        <button class="btn btn-neutral" (click)="saveAddress()">
          Save
        </button>
        <button class="btn bg-base-100 text-error" (click)="deleteAddress(address.label)">
          Delete
        </button>
        }
        @else {
        @if (showAddressInfo) {
        <button class="btn btn-neutral" (click)="saveAddress()">
          Add Address
        </button>
        }
        @else {
        <button class="btn btn-neutral" (click)="showAddressInfo = true;">
          Enter Address <fa-icon icon="pencil"></fa-icon>
        </button>
        }
        }
      </div>

      <button class="btn btn-soft" (click)="cancel()">
        Cancel
      </button>
    </div>
  </div>
</div>